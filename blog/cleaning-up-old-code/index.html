<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
<meta content="IE=edge" http-equiv="X-UA-Compatible"/>
<meta content="text/html; charset=UTF-8" http-equiv="content-type"/>
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
<meta name="robots" content="index, follow">
















<title>Cleaning up old Elixir code</title>



<meta name="title" content="Cleaning up old Elixir code">


<meta name="author" content="phil">


<meta name="description" content="rantbox">

<meta property="og:type" content="website">
<meta property="og:url" content="https://100phlecs.github.io/blog/cleaning-up-old-code/">

<meta property="og:site_name" content="">


<meta property="og:title" content="Cleaning up old Elixir code">


<meta property="og:description" content="rantbox">


<meta property="og:image" content="https:&#x2F;&#x2F;100phlecs.github.io&#x2F;favicon.ico">



<meta property="twitter:card" content="summary_large_image">
<meta property="twitter:url" content="https://100phlecs.github.io/blog/cleaning-up-old-code/">

<meta property="twitter:title" content="Cleaning up old Elixir code">


<meta property="twitter:description" content="rantbox">


<meta property="twitter:image" content="https:&#x2F;&#x2F;100phlecs.github.io&#x2F;favicon.ico">


<link rel="canonical" href="https://100phlecs.github.io/blog/cleaning-up-old-code/">

<link rel="shortcut icon" type="image/x-icon" href="https://100phlecs.github.io/favicon.ico">




<link rel="alternate" type="application/atom+xml" title="RSS" href="https://100phlecs.github.io/atom.xml"> 



<link rel="stylesheet" href="https://100phlecs.github.io/style.css"/>

  </head>
  <body>
    <div class="wrapper">
      <header>
        
<nav class="navBar">
  
  
  
  <a href="https://100phlecs.github.io" >&#x2F;home&#x2F;</a>
  
  
  
  
  <a href="https://100phlecs.github.io/journal" >&#x2F;journal&#x2F;</a>
  
  
  
  
  <a href="https://100phlecs.github.io/blog" >&#x2F;blog&#x2F;</a>
  
  
  <div class="themeSwitch">
    <button class="themeButton light" onclick="setTheme('light')" title="Light mode"><svg class="icons icons__background"><use href="https://100phlecs.github.io/icons.svg#lightMode"></use></svg></button>
    <button class="themeButton dark" onclick="setTheme('dark')" title="Dark mode"><svg class="icons icons__background"><use href="https://100phlecs.github.io/icons.svg#darkMode"></use></svg></button>
  </div>
</nav>

<script>
  const setTheme = (theme) => {
      document.documentElement.className = theme;
      localStorage.setItem('theme', theme);
  }
  const getTheme = () => {
      const theme = localStorage.getItem('theme');
      theme && setTheme(theme);
  }
  getTheme()
</script>
      </header>
      <main>
        
<div><a href="..">..</a>/<span class="metaData">cleaning-up-old-code</span></div>
<time datetime="2023-10-05">Published on: <span class="metaData">2023-10-05</span></time>
<h1>Cleaning up old Elixir code</h1>



<p>Itâ€™s been awhile since I last looked at the <a rel="noopener" target="_blank" href="https://github.com/100phlecs/tailwind_formatter"><code>TailwindFormatter</code></a> library.</p>
<p><code>TailwindFormatter</code> is a <a rel="noopener" target="_blank" href="https://hexdocs.pm/mix/main/Mix.Tasks.Format.html#module-plugins">Mix Format</a> extension to sort TailwindCSS classes with a few divergences. </p>
<p>Naively I went for the Regex approach. The algorithm went something like:</p>
<ol>
<li>Fetch all class attributes with a complex Regex</li>
<li>Within that, validate and substitute all Elixir code</li>
<li>Sort the variants and classes in layers</li>
<li>Put back the Elixir functions</li>
<li>Add additional ASCII to properly swap it out</li>
</ol>
<p>Here are the four regex patterns the library uses to find classes:</p>
<pre data-lang="elixir" class="language-elixir z-code"><code class="language-elixir" data-lang="elixir"><span class="z-source z-elixir"><span class="z-variable z-other z-module z-elixir"><span class="z-keyword z-operator z-definition z-constant z-elixir">@</span>class_pattern</span> <span class="z-meta z-string z-elixir"><span class="z-storage z-type z-string z-elixir">~r</span></span><span class="z-meta z-string z-elixir"><span class="z-string z-interpolated z-elixir"><span class="z-punctuation z-definition z-string z-begin z-elixir">/</span><span class="z-meta z-group z-regexp z-elixir"><span class="z-keyword z-control z-group z-regexp z-elixir"><span class="z-punctuation z-definition z-group z-begin z-regexp z-elixir">(</span></span><span class="z-keyword z-control z-non-capturing-group z-regexp z-elixir">?:</span></span><span class="z-meta z-group z-regexp z-elixir"><span class="z-meta z-literal z-regexp z-elixir">c</span><span class="z-meta z-literal z-regexp z-elixir">l</span><span class="z-meta z-literal z-regexp z-elixir">a</span><span class="z-meta z-literal z-regexp z-elixir">s</span><span class="z-meta z-literal z-regexp z-elixir">s</span><span class="z-constant z-other z-escape-sequence z-regexp z-elixir">\s</span><span class="z-meta z-quantifier z-regexp z-elixir"><span class="z-keyword z-operator z-quantifier z-regexp z-elixir">*</span></span><span class="z-meta z-group z-regexp z-elixir"><span class="z-keyword z-control z-group z-regexp z-elixir"><span class="z-punctuation z-definition z-group z-begin z-regexp z-elixir">(</span></span><span class="z-keyword z-control z-non-capturing-group z-regexp z-elixir">?:</span></span><span class="z-meta z-group z-regexp z-elixir"><span class="z-meta z-literal z-regexp z-elixir">=</span><span class="z-keyword z-operator z-alternation z-regexp z-elixir">|</span><span class="z-meta z-literal z-regexp z-elixir">:</span></span><span class="z-meta z-group z-regexp z-elixir"><span class="z-keyword z-control z-group z-regexp z-elixir"><span class="z-punctuation z-definition z-group z-end z-regexp z-elixir">)</span></span></span><span class="z-constant z-other z-escape-sequence z-regexp z-elixir">\s</span><span class="z-meta z-quantifier z-regexp z-elixir"><span class="z-keyword z-operator z-quantifier z-regexp z-elixir">*</span></span></span><span class="z-meta z-group z-regexp z-elixir"><span class="z-keyword z-control z-group z-regexp z-elixir"><span class="z-punctuation z-definition z-group z-end z-regexp z-elixir">)</span></span></span><span class="z-meta z-group z-regexp z-elixir"><span class="z-keyword z-control z-group z-regexp z-elixir"><span class="z-punctuation z-definition z-group z-begin z-regexp z-elixir">(</span></span></span><span class="z-meta z-group z-regexp z-elixir"><span class="z-meta z-group z-regexp z-elixir"><span class="z-keyword z-control z-group z-regexp z-elixir"><span class="z-punctuation z-definition z-group z-begin z-regexp z-elixir">(</span></span></span><span class="z-meta z-group z-regexp z-elixir"><span class="z-constant z-character z-escape z-regexp z-elixir">\{</span></span><span class="z-meta z-group z-regexp z-elixir"><span class="z-keyword z-control z-group z-regexp z-elixir"><span class="z-punctuation z-definition z-group z-end z-regexp z-elixir">)</span></span></span><span class="z-keyword z-operator z-alternation z-regexp z-elixir">|</span><span class="z-meta z-group z-regexp z-elixir"><span class="z-keyword z-control z-group z-regexp z-elixir"><span class="z-punctuation z-definition z-group z-begin z-regexp z-elixir">(</span></span></span><span class="z-meta z-group z-regexp z-elixir"><span class="z-meta z-literal z-regexp z-elixir">&#39;</span><span class="z-keyword z-operator z-alternation z-regexp z-elixir">|</span><span class="z-meta z-literal z-regexp z-elixir">&quot;</span></span><span class="z-meta z-group z-regexp z-elixir"><span class="z-keyword z-control z-group z-regexp z-elixir"><span class="z-punctuation z-definition z-group z-end z-regexp z-elixir">)</span></span></span></span><span class="z-meta z-group z-regexp z-elixir"><span class="z-keyword z-control z-group z-regexp z-elixir"><span class="z-punctuation z-definition z-group z-end z-regexp z-elixir">)</span></span></span><span class="z-meta z-group z-regexp z-elixir"><span class="z-keyword z-control z-group z-regexp z-elixir"><span class="z-punctuation z-definition z-group z-begin z-regexp z-elixir">(</span></span></span><span class="z-meta z-group z-regexp z-elixir"><span class="z-keyword z-other z-any z-regexp z-elixir">.</span><span class="z-keyword z-operator z-alternation z-regexp z-elixir">|</span><span class="z-constant z-other z-escape-sequence z-regexp z-elixir">\s</span></span><span class="z-meta z-group z-regexp z-elixir"><span class="z-keyword z-control z-group z-regexp z-elixir"><span class="z-punctuation z-definition z-group z-end z-regexp z-elixir">)</span></span></span><span class="z-meta z-quantifier z-regexp z-elixir"><span class="z-keyword z-operator z-quantifier z-regexp z-elixir">*?</span></span><span class="z-meta z-group z-regexp z-elixir"><span class="z-keyword z-control z-group z-regexp z-elixir"><span class="z-punctuation z-definition z-group z-begin z-regexp z-elixir">(</span></span></span><span class="z-meta z-group z-regexp z-elixir"><span class="z-meta z-conditional z-regexp z-elixir"><span class="z-keyword z-control z-conditional z-regexp z-elixir">?<span class="z-punctuation z-definition z-conditional z-begin z-regexp z-elixir">(</span></span></span><span class="z-meta z-conditional z-regexp z-elixir"><span class="z-invalid z-illegal z-conditional z-regexp z-elixir">2</span><span class="z-keyword z-control z-conditional z-regexp z-elixir"><span class="z-punctuation z-definition z-conditional z-end z-regexp z-elixir">)</span></span></span><span class="z-meta z-group z-regexp z-elixir"><span class="z-constant z-character z-escape z-regexp z-elixir">\}</span><span class="z-keyword z-operator z-alternation z-regexp z-elixir">|</span><span class="z-meta z-group z-regexp z-elixir"><span class="z-keyword z-control z-group z-regexp z-elixir"><span class="z-punctuation z-definition z-group z-begin z-regexp z-elixir">(</span></span></span><span class="z-meta z-group z-regexp z-elixir"><span class="z-meta z-literal z-regexp z-elixir">&quot;</span><span class="z-keyword z-operator z-alternation z-regexp z-elixir">|</span><span class="z-meta z-literal z-regexp z-elixir">&#39;</span></span><span class="z-meta z-group z-regexp z-elixir"><span class="z-keyword z-control z-group z-regexp z-elixir"><span class="z-punctuation z-definition z-group z-end z-regexp z-elixir">)</span></span></span></span><span class="z-meta z-group z-regexp z-elixir"><span class="z-keyword z-control z-group z-regexp z-elixir"><span class="z-punctuation z-definition z-group z-end z-regexp z-elixir">)</span></span></span></span>/</span></span><span class="z-meta z-string z-elixir"><span class="z-string z-quoted z-modifiers z-elixir"><span class="z-storage z-type z-string z-elixir">i</span></span></span>
<span class="z-variable z-other z-module z-elixir"><span class="z-keyword z-operator z-definition z-constant z-elixir">@</span>inline_func_pattern</span> <span class="z-meta z-string z-elixir"><span class="z-storage z-type z-string z-elixir">~r</span></span><span class="z-meta z-string z-elixir"><span class="z-string z-interpolated z-elixir"><span class="z-punctuation z-definition z-string z-begin z-elixir">/</span><span class="z-meta z-literal z-regexp z-elixir">#</span><span class="z-constant z-character z-escape z-regexp z-elixir">\{</span><span class="z-meta z-group z-regexp z-elixir"><span class="z-keyword z-control z-group z-regexp z-elixir"><span class="z-punctuation z-definition z-group z-begin z-regexp z-elixir">(</span></span></span><span class="z-meta z-group z-regexp z-elixir"><span class="z-meta z-group z-regexp z-elixir"><span class="z-keyword z-control z-group z-regexp z-elixir"><span class="z-punctuation z-definition z-group z-begin z-regexp z-elixir">(</span></span><span class="z-keyword z-control z-non-capturing-group z-regexp z-elixir">?:</span></span><span class="z-meta z-group z-regexp z-elixir"><span class="z-meta z-group z-regexp z-elixir"><span class="z-keyword z-control z-group z-regexp z-elixir"><span class="z-punctuation z-definition z-group z-begin z-regexp z-elixir">(</span></span><span class="z-keyword z-control z-non-capturing-group z-regexp z-elixir">?:</span></span><span class="z-meta z-group z-regexp z-elixir"><span class="z-meta z-group z-regexp z-elixir"><span class="z-keyword z-control z-group z-regexp z-elixir"><span class="z-punctuation z-definition z-group z-begin z-regexp z-elixir">(</span></span><span class="z-keyword z-control z-assertion z-regexp z-elixir">?!</span></span><span class="z-meta z-group z-regexp z-elixir"><span class="z-meta z-group z-regexp z-elixir"><span class="z-keyword z-control z-group z-regexp z-elixir"><span class="z-punctuation z-definition z-group z-begin z-regexp z-elixir">(</span></span></span><span class="z-meta z-group z-regexp z-elixir"><span class="z-meta z-literal z-regexp z-elixir">#</span><span class="z-constant z-character z-escape z-regexp z-elixir">\{</span><span class="z-keyword z-operator z-alternation z-regexp z-elixir">|</span><span class="z-constant z-character z-escape z-regexp z-elixir">\}</span></span><span class="z-meta z-group z-regexp z-elixir"><span class="z-keyword z-control z-group z-regexp z-elixir"><span class="z-punctuation z-definition z-group z-end z-regexp z-elixir">)</span></span></span></span><span class="z-meta z-group z-regexp z-elixir"><span class="z-keyword z-control z-group z-regexp z-elixir"><span class="z-punctuation z-definition z-group z-end z-regexp z-elixir">)</span></span></span><span class="z-keyword z-other z-any z-regexp z-elixir">.</span></span><span class="z-meta z-group z-regexp z-elixir"><span class="z-keyword z-control z-group z-regexp z-elixir"><span class="z-punctuation z-definition z-group z-end z-regexp z-elixir">)</span></span></span><span class="z-keyword z-operator z-alternation z-regexp z-elixir">|</span><span class="z-keyword z-other z-subroutine z-regexp z-elixir">(?<span class="z-variable z-other z-subroutine z-regexp z-elixir">R</span>)</span></span><span class="z-meta z-group z-regexp z-elixir"><span class="z-keyword z-control z-group z-regexp z-elixir"><span class="z-punctuation z-definition z-group z-end z-regexp z-elixir">)</span></span></span><span class="z-meta z-quantifier z-regexp z-elixir"><span class="z-keyword z-operator z-quantifier z-regexp z-elixir">*</span></span></span><span class="z-meta z-group z-regexp z-elixir"><span class="z-keyword z-control z-group z-regexp z-elixir"><span class="z-punctuation z-definition z-group z-end z-regexp z-elixir">)</span></span></span><span class="z-constant z-character z-escape z-regexp z-elixir">\}</span>/</span></span><span class="z-meta z-string z-elixir"><span class="z-string z-quoted z-modifiers z-elixir"><span class="z-storage z-type z-string z-elixir">i</span></span></span>
<span class="z-variable z-other z-module z-elixir"><span class="z-keyword z-operator z-definition z-constant z-elixir">@</span>dynamic_classes</span> <span class="z-meta z-string z-elixir"><span class="z-storage z-type z-string z-elixir">~r</span></span><span class="z-meta z-string z-elixir"><span class="z-string z-interpolated z-elixir"><span class="z-punctuation z-definition z-string z-begin z-elixir">/</span><span class="z-meta z-set z-regexp z-elixir"><span class="z-keyword z-control z-set z-regexp z-elixir"><span class="z-punctuation z-definition z-set z-begin z-regexp z-elixir">[</span></span><span class="z-constant z-other z-set z-posix z-regexp z-elixir"><span class="z-keyword z-control z-set z-posix z-regexp z-elixir"><span class="z-punctuation z-definition z-posix-class z-begin z-regexp z-elixir">[:</span></span><span class="z-constant z-other z-posix-class z-name z-regexp z-elixir">alnum</span><span class="z-keyword z-control z-set z-posix z-regexp z-elixir"><span class="z-punctuation z-definition z-posix-class z-end z-regexp z-elixir">:]</span></span></span><span class="z-meta z-literal z-regexp z-elixir">-</span><span class="z-keyword z-control z-set z-regexp z-elixir"><span class="z-punctuation z-definition z-set z-end z-regexp z-elixir">]</span></span></span><span class="z-meta z-quantifier z-regexp z-elixir"><span class="z-keyword z-operator z-quantifier z-regexp z-elixir">*</span></span><span class="z-meta z-literal z-regexp z-elixir">#</span><span class="z-constant z-character z-escape z-regexp z-elixir">\{</span><span class="z-meta z-group z-regexp z-elixir"><span class="z-keyword z-control z-group z-regexp z-elixir"><span class="z-punctuation z-definition z-group z-begin z-regexp z-elixir">(</span></span></span><span class="z-meta z-group z-regexp z-elixir"><span class="z-meta z-set z-regexp z-elixir"><span class="z-keyword z-control z-set z-regexp z-elixir"><span class="z-punctuation z-definition z-set z-begin z-regexp z-elixir">[</span></span><span class="z-keyword z-operator z-negation z-regexp z-elixir">^</span><span class="z-meta z-literal z-regexp z-elixir">}</span><span class="z-keyword z-control z-set z-regexp z-elixir"><span class="z-punctuation z-definition z-set z-end z-regexp z-elixir">]</span></span></span><span class="z-meta z-quantifier z-regexp z-elixir"><span class="z-keyword z-operator z-quantifier z-regexp z-elixir">+</span></span></span><span class="z-meta z-group z-regexp z-elixir"><span class="z-keyword z-control z-group z-regexp z-elixir"><span class="z-punctuation z-definition z-group z-end z-regexp z-elixir">)</span></span></span><span class="z-constant z-character z-escape z-regexp z-elixir">\}</span><span class="z-meta z-quantifier z-regexp z-elixir"><span class="z-keyword z-operator z-quantifier z-regexp z-elixir">*</span></span>/</span></span><span class="z-meta z-string z-elixir"><span class="z-string z-quoted z-modifiers z-elixir"><span class="z-storage z-type z-string z-elixir">i</span></span></span>
<span class="z-variable z-other z-module z-elixir"><span class="z-keyword z-operator z-definition z-constant z-elixir">@</span>invalid_input</span> <span class="z-meta z-string z-elixir"><span class="z-storage z-type z-string z-elixir">~r</span></span><span class="z-meta z-string z-elixir"><span class="z-string z-interpolated z-elixir"><span class="z-punctuation z-definition z-string z-begin z-elixir">/</span><span class="z-meta z-set z-regexp z-elixir"><span class="z-keyword z-control z-set z-regexp z-elixir"><span class="z-punctuation z-definition z-set z-begin z-regexp z-elixir">[</span></span><span class="z-keyword z-operator z-negation z-regexp z-elixir">^</span><span class="z-meta z-literal z-regexp z-elixir">_</span><span class="z-meta z-character-range z-regexp z-elixir"><span class="z-constant z-other z-range z-regexp z-elixir">a</span></span><span class="z-meta z-character-range z-regexp z-elixir"><span class="z-keyword z-operator z-range z-regexp z-elixir">-</span><span class="z-constant z-other z-range z-regexp z-elixir">z</span></span><span class="z-meta z-character-range z-regexp z-elixir"><span class="z-constant z-other z-range z-regexp z-elixir">A</span></span><span class="z-meta z-character-range z-regexp z-elixir"><span class="z-keyword z-operator z-range z-regexp z-elixir">-</span><span class="z-constant z-other z-range z-regexp z-elixir">Z</span></span><span class="z-meta z-character-range z-regexp z-elixir"><span class="z-constant z-other z-range z-regexp z-elixir">0</span></span><span class="z-meta z-character-range z-regexp z-elixir"><span class="z-keyword z-operator z-range z-regexp z-elixir">-</span><span class="z-constant z-other z-range z-regexp z-elixir">9</span></span><span class="z-constant z-character z-escape z-regexp z-elixir">\$</span><span class="z-constant z-other z-escape-sequence z-regexp z-elixir">\s</span><span class="z-constant z-character z-escape z-regexp z-elixir">\-</span><span class="z-meta z-literal z-regexp z-elixir">:</span><span class="z-constant z-character z-escape z-regexp z-elixir">\[</span><span class="z-constant z-character z-escape z-regexp z-elixir">\]</span><span class="z-constant z-character z-escape z-regexp z-elixir">\/</span><span class="z-constant z-character z-escape z-dot z-regexp z-elixir">\.</span><span class="z-constant z-character z-escape z-regexp z-elixir">\#</span><span class="z-keyword z-control z-set z-regexp z-elixir"><span class="z-punctuation z-definition z-set z-end z-regexp z-elixir">]</span></span></span><span class="z-meta z-quantifier z-regexp z-elixir"><span class="z-keyword z-operator z-quantifier z-regexp z-elixir">+</span></span>/</span></span>
</span></code></pre>
<p>Pretty complicatedâ€¦</p>
<p>Since the <code>class</code> attribute within a Phoenix template can hold any valid Elixir expression, one can conclude this isnâ€™t sustainable. </p>
<p>The solution is to use the Phoenix tokenizers and handle the AST representation of each <code>class</code>. 
So I took the time and converted the library over to use the Phoenix tokenizers. Itâ€™s a lot simpler, but I wouldnâ€™t entirely attribute it to the different approach. 
After programming in Elixir for awhile, I found some of my previous code easier to clean up.</p>
<p>Hereâ€™s the new entry point of the plugin:</p>
<pre data-lang="elixir" class="language-elixir z-code"><code class="language-elixir" data-lang="elixir"><span class="z-source z-elixir"><span class="z-meta z-function z-elixir">  <span class="z-keyword z-control z-module z-elixir">def</span> <span class="z-entity z-name z-function z-public z-elixir">format</span><span class="z-punctuation z-definition z-parameters z-elixir">(</span>contents<span class="z-punctuation z-separator z-object z-elixir">,</span> _opts<span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-control z-module z-elixir">do</span></span>
    contents
    <span class="z-keyword z-operator z-pipe z-elixir">|&gt;</span> <span class="z-entity z-name z-class z-elixir">HEExTokenizer</span><span class="z-punctuation z-separator z-method z-elixir">.</span>tokenize<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-function z-elixir">)</span>
    <span class="z-keyword z-operator z-pipe z-elixir">|&gt;</span> <span class="z-entity z-name z-class z-elixir">Enum</span><span class="z-punctuation z-separator z-method z-elixir">.</span>reduce<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-array z-elixir">[</span><span class="z-punctuation z-section z-array z-elixir">]</span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-variable z-other z-capture z-elixir"><span class="z-keyword z-operator z-capture z-elixir">&amp;</span>collect_classes</span><span class="z-keyword z-operator z-arithmetic z-elixir">/</span><span class="z-constant z-numeric z-elixir">2</span><span class="z-punctuation z-section z-function z-elixir">)</span>
    <span class="z-keyword z-operator z-pipe z-elixir">|&gt;</span> <span class="z-entity z-name z-class z-elixir">Enum</span><span class="z-punctuation z-separator z-method z-elixir">.</span>reduce<span class="z-punctuation z-section z-function z-elixir">(</span>contents<span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-variable z-other z-capture z-elixir"><span class="z-keyword z-operator z-capture z-elixir">&amp;</span>sort_classes</span><span class="z-keyword z-operator z-arithmetic z-elixir">/</span><span class="z-constant z-numeric z-elixir">2</span><span class="z-punctuation z-section z-function z-elixir">)</span>
  <span class="z-keyword z-control z-elixir">end</span>
</span></code></pre>
<p><code>collect_classes</code> is pretty straightforward:</p>
<pre data-lang="elixir" class="language-elixir z-code"><code class="language-elixir" data-lang="elixir"><span class="z-source z-elixir"><span class="z-meta z-function z-elixir">  <span class="z-keyword z-control z-module z-elixir">defp</span> <span class="z-entity z-name z-function z-private z-elixir">collect_classes</span><span class="z-punctuation z-definition z-parameters z-elixir">(</span><span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span><span class="z-constant z-other z-symbol z-elixir"><span class="z-punctuation z-definition z-constant z-elixir">:</span>tag</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> _name<span class="z-punctuation z-separator z-sequence z-elixir">,</span> attrs<span class="z-punctuation z-separator z-sequence z-elixir">,</span> _meta<span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span><span class="z-punctuation z-separator z-object z-elixir">,</span> acc<span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-control z-module z-elixir">do</span></span>
    <span class="z-keyword z-control z-elixir">case</span> <span class="z-entity z-name z-class z-elixir">Enum</span><span class="z-punctuation z-separator z-method z-elixir">.</span>find<span class="z-punctuation z-section z-function z-elixir">(</span>attrs<span class="z-punctuation z-separator z-object z-elixir">,</span> &amp;<span class="z-punctuation z-section z-function z-elixir">(</span>elem<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-constant z-other z-capture z-elixir"><span class="z-keyword z-operator z-capture z-elixir">&amp;</span>1</span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-numeric z-elixir">0</span><span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-operator z-comparison z-elixir">==</span> <span class="z-meta z-string z-elixir"><span class="z-string z-quoted z-double z-elixir"><span class="z-punctuation z-definition z-string z-begin z-elixir">&quot;</span>class<span class="z-punctuation z-definition z-string z-end z-elixir">&quot;</span></span></span><span class="z-punctuation z-section z-function z-elixir">)</span><span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-control z-elixir">do</span>
      <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span><span class="z-meta z-string z-elixir"><span class="z-string z-quoted z-double z-elixir"><span class="z-punctuation z-definition z-string z-begin z-elixir">&quot;</span>class<span class="z-punctuation z-definition z-string z-end z-elixir">&quot;</span></span></span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> class<span class="z-punctuation z-separator z-sequence z-elixir">,</span> _meta<span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span> <span class="z-keyword z-operator z-arrow z-elixir">-&gt;</span> <span class="z-punctuation z-section z-array z-elixir">[</span>class <span class="z-keyword z-operator z-other z-elixir">|</span> acc<span class="z-punctuation z-section z-array z-elixir">]</span>
      <span class="z-constant z-language z-elixir">nil</span> <span class="z-keyword z-operator z-arrow z-elixir">-&gt;</span> acc
    <span class="z-keyword z-control z-elixir">end</span>
  <span class="z-keyword z-control z-elixir">end</span>
</span></code></pre>
<p><code>sort_classes</code> goes more into the AST stuff which I wonâ€™t go through. What it does is that it handles things like:</p>
<pre data-lang="elixir" class="language-elixir z-code"><code class="language-elixir" data-lang="elixir"><span class="z-source z-elixir"><span class="z-keyword z-operator z-comparison z-elixir">&lt;</span>div class<span class="z-keyword z-operator z-assignment z-elixir">=</span><span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span><span class="z-meta z-string z-elixir"><span class="z-string z-quoted z-double z-elixir"><span class="z-punctuation z-definition z-string z-begin z-elixir">&quot;</span>grid-cols-</span></span></span></span><span class="z-source z-elixir"><span class="z-meta z-sequence z-tuple z-elixir"><span class="z-meta z-string z-elixir"><span class="z-string z-quoted z-double z-elixir"><span class="z-source z-elixir"><span class="z-meta z-string z-elixir"><span class="z-meta z-interpolation z-elixir"><span class="z-punctuation z-section z-interpolation z-begin z-elixir">#{</span></span></span></span></span></span></span></span><span class="z-source z-elixir"><span class="z-meta z-string z-elixir"><span class="z-meta z-interpolation z-elixir"><span class="z-source z-elixir z-embedded"><span class="z-variable z-other z-module z-elixir"><span class="z-keyword z-operator z-definition z-constant z-elixir">@</span>num</span></span><span class="z-punctuation z-section z-interpolation z-end z-elixir">}</span></span></span></span><span class="z-source z-elixir"><span class="z-meta z-sequence z-tuple z-elixir"><span class="z-meta z-string z-elixir"><span class="z-string z-quoted z-double z-elixir">-custom bg-red-300<span class="z-punctuation z-definition z-string z-end z-elixir">&quot;</span></span></span><span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span> <span class="z-keyword z-operator z-arithmetic z-elixir">/</span><span class="z-keyword z-operator z-comparison z-elixir">&gt;</span> 
<span class="z-keyword z-operator z-comparison z-elixir">&lt;</span>div class<span class="z-keyword z-operator z-assignment z-elixir">=</span><span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span><span class="z-meta z-string z-elixir"><span class="z-string z-quoted z-double z-elixir"><span class="z-punctuation z-definition z-string z-begin z-elixir">&quot;</span></span></span></span></span><span class="z-source z-elixir"><span class="z-meta z-sequence z-tuple z-elixir"><span class="z-meta z-string z-elixir"><span class="z-string z-quoted z-double z-elixir"><span class="z-source z-elixir"><span class="z-meta z-string z-elixir"><span class="z-meta z-interpolation z-elixir"><span class="z-punctuation z-section z-interpolation z-begin z-elixir">#{</span></span></span></span></span></span></span></span><span class="z-source z-elixir"><span class="z-meta z-string z-elixir"><span class="z-meta z-interpolation z-elixir"><span class="z-source z-elixir z-embedded"><span class="z-keyword z-control z-elixir">if</span> <span class="z-variable z-other z-module z-elixir"><span class="z-keyword z-operator z-definition z-constant z-elixir">@</span>active</span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-other z-keywords z-elixir">do<span class="z-punctuation z-definition z-constant z-elixir">:</span></span> <span class="z-meta z-string z-elixir"><span class="z-string z-quoted z-double z-elixir"><span class="z-punctuation z-definition z-string z-begin z-elixir">&quot;</span>bg-red-50<span class="z-punctuation z-definition z-string z-end z-elixir">&quot;</span></span></span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-other z-keywords z-elixir">else<span class="z-punctuation z-definition z-constant z-elixir">:</span></span> <span class="z-meta z-string z-elixir"><span class="z-string z-quoted z-double z-elixir"><span class="z-punctuation z-definition z-string z-begin z-elixir">&quot;</span>hidden<span class="z-punctuation z-definition z-string z-end z-elixir">&quot;</span></span></span></span><span class="z-punctuation z-section z-interpolation z-end z-elixir">}</span></span></span></span><span class="z-source z-elixir"><span class="z-meta z-sequence z-tuple z-elixir"><span class="z-meta z-string z-elixir"><span class="z-string z-quoted z-double z-elixir"> h-10 w-full leading-5<span class="z-punctuation z-definition z-string z-end z-elixir">&quot;</span></span></span><span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span> <span class="z-keyword z-operator z-arithmetic z-elixir">/</span><span class="z-keyword z-operator z-comparison z-elixir">&gt;</span> 
<span class="z-keyword z-operator z-comparison z-elixir">&lt;</span>div class<span class="z-keyword z-operator z-assignment z-elixir">=</span><span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span><span class="z-meta z-string z-elixir"><span class="z-string z-quoted z-double z-elixir"><span class="z-punctuation z-definition z-string z-begin z-elixir">&quot;</span>h-6 <span class="z-punctuation z-definition z-string z-end z-elixir">&quot;</span></span></span> <span class="z-keyword z-operator z-binary-concatenation z-elixir">&lt;&gt;</span> <span class="z-keyword z-control z-elixir">if</span> <span class="z-variable z-other z-module z-elixir"><span class="z-keyword z-operator z-definition z-constant z-elixir">@</span>active</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-constant z-other z-keywords z-elixir">do<span class="z-punctuation z-definition z-constant z-elixir">:</span></span> <span class="z-meta z-string z-elixir"><span class="z-string z-quoted z-double z-elixir"><span class="z-punctuation z-definition z-string z-begin z-elixir">&quot;</span>font-bold<span class="z-punctuation z-definition z-string z-end z-elixir">&quot;</span></span></span><span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span> <span class="z-keyword z-operator z-arithmetic z-elixir">/</span><span class="z-keyword z-operator z-comparison z-elixir">&gt;</span>
</span></code></pre>
<p>Elixir expressions.</p>
<p>Instead, letâ€™s go to the part where it sorts the <code>class</code> string, something like:</p>
<pre data-lang="html" class="language-html z-code"><code class="language-html" data-lang="html"><span class="z-text z-html z-basic"><span class="z-meta z-tag z-block z-any z-html"><span class="z-punctuation z-definition z-tag z-begin z-html">&lt;</span><span class="z-entity z-name z-tag z-block z-any z-html">div</span> <span class="z-meta z-attribute-with-value z-class z-html"><span class="z-entity z-other z-attribute-name z-class z-html">class</span><span class="z-punctuation z-separator z-key-value z-html">=</span><span class="z-string z-quoted z-double z-html"><span class="z-punctuation z-definition z-string z-begin z-html">&quot;</span></span><span class="z-string z-quoted z-double z-html"><span class="z-meta z-class-name z-html">h-8</span> <span class="z-meta z-class-name z-html">w-8</span> <span class="z-meta z-class-name z-html">bg-slate-500</span> <span class="z-meta z-class-name z-html">md:w-16</span> <span class="z-meta z-class-name z-html">md:h-12</span> <span class="z-meta z-class-name z-html">lg:flex</span><span class="z-punctuation z-definition z-string z-end z-html">&quot;</span></span></span><span class="z-punctuation z-definition z-tag z-end z-html">&gt;</span></span><span class="z-meta z-tag z-block z-any z-html"><span class="z-punctuation z-definition z-tag z-begin z-html">&lt;/</span><span class="z-entity z-name z-tag z-block z-any z-html">div</span><span class="z-punctuation z-definition z-tag z-end z-html">&gt;</span></span>
</span></code></pre>
<p>Hereâ€™s the previous <code>sort</code> function entry point:</p>
<pre data-lang="elixir" class="language-elixir z-code"><code class="language-elixir" data-lang="elixir"><span class="z-source z-elixir"><span class="z-meta z-function z-elixir"><span class="z-keyword z-control z-module z-elixir">defp</span> <span class="z-entity z-name z-function z-private z-elixir">sort</span><span class="z-punctuation z-definition z-parameters z-elixir">(</span><span class="z-punctuation z-section z-array z-elixir">[</span><span class="z-punctuation z-section z-array z-elixir">]</span><span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-control z-module z-elixir">do</span></span>
  <span class="z-punctuation z-section z-array z-elixir">[</span><span class="z-punctuation z-section z-array z-elixir">]</span>
<span class="z-keyword z-control z-elixir">end</span>

<span class="z-meta z-function z-elixir"><span class="z-keyword z-control z-module z-elixir">defp</span> <span class="z-entity z-name z-function z-private z-elixir">sort</span><span class="z-punctuation z-definition z-parameters z-elixir">(</span>class_list<span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-control z-module z-elixir">do</span></span>
  <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span>variants<span class="z-punctuation z-separator z-sequence z-elixir">,</span> base_classes<span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span> <span class="z-keyword z-operator z-assignment z-elixir">=</span> separate<span class="z-punctuation z-section z-function z-elixir">(</span>class_list<span class="z-punctuation z-section z-function z-elixir">)</span>
  base_sorted <span class="z-keyword z-operator z-assignment z-elixir">=</span> sort_base_classes<span class="z-punctuation z-section z-function z-elixir">(</span>base_classes<span class="z-punctuation z-section z-function z-elixir">)</span>
  variant_sorted <span class="z-keyword z-operator z-assignment z-elixir">=</span> sort_variant_classes<span class="z-punctuation z-section z-function z-elixir">(</span>variants<span class="z-punctuation z-section z-function z-elixir">)</span>

  base_sorted <span class="z-keyword z-operator z-list-manipulation z-elixir">++</span> variant_sorted
<span class="z-keyword z-control z-elixir">end</span>
</span></code></pre>
<p>For those unfamiliar with Elixir, the above is pattern matching on the function parameter. It goes in declaration order. So in this case, if the parameter passed matches <code>[]</code> it goes to the first function, returning a <code>[]</code>. Otherwise it continues to check against the other functions.</p>
<p>Letâ€™s look at <code>sort_base_classes(base_classes)</code></p>
<pre data-lang="elixir" class="language-elixir z-code"><code class="language-elixir" data-lang="elixir"><span class="z-source z-elixir"><span class="z-meta z-function z-elixir"><span class="z-keyword z-control z-module z-elixir">defp</span> <span class="z-entity z-name z-function z-private z-elixir">sort_base_classes</span><span class="z-punctuation z-definition z-parameters z-elixir">(</span>base_classes<span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-control z-module z-elixir">do</span></span>
  base_classes
  <span class="z-keyword z-operator z-pipe z-elixir">|&gt;</span> <span class="z-entity z-name z-class z-elixir">Enum</span><span class="z-punctuation z-separator z-method z-elixir">.</span>map<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-keyword z-control z-elixir">fn</span> class <span class="z-keyword z-operator z-other z-elixir">-&gt;</span>
    sort_number <span class="z-keyword z-operator z-assignment z-elixir">=</span> get_sort_position<span class="z-punctuation z-section z-function z-elixir">(</span>class<span class="z-punctuation z-section z-function z-elixir">)</span>
    <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span>sort_number<span class="z-punctuation z-separator z-sequence z-elixir">,</span> class<span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span>
  <span class="z-keyword z-control z-elixir">end</span><span class="z-punctuation z-section z-function z-elixir">)</span>
  <span class="z-keyword z-operator z-pipe z-elixir">|&gt;</span> <span class="z-entity z-name z-class z-elixir">Enum</span><span class="z-punctuation z-separator z-method z-elixir">.</span>sort_by<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-variable z-other z-capture z-elixir"><span class="z-keyword z-operator z-capture z-elixir">&amp;</span>elem</span><span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-constant z-other z-capture z-elixir"><span class="z-keyword z-operator z-capture z-elixir">&amp;</span>1</span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-numeric z-elixir">0</span><span class="z-punctuation z-section z-function z-elixir">)</span><span class="z-punctuation z-section z-function z-elixir">)</span>
  <span class="z-keyword z-operator z-pipe z-elixir">|&gt;</span> <span class="z-entity z-name z-class z-elixir">Enum</span><span class="z-punctuation z-separator z-method z-elixir">.</span>map<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-variable z-other z-capture z-elixir"><span class="z-keyword z-operator z-capture z-elixir">&amp;</span>elem</span><span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-constant z-other z-capture z-elixir"><span class="z-keyword z-operator z-capture z-elixir">&amp;</span>1</span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-numeric z-elixir">1</span><span class="z-punctuation z-section z-function z-elixir">)</span><span class="z-punctuation z-section z-function z-elixir">)</span>
<span class="z-keyword z-control z-elixir">end</span>
</span></code></pre>
<p>This was poorly written, and was written by me. You can reduce this down to:</p>
<pre data-lang="elixir" class="language-elixir z-code"><code class="language-elixir" data-lang="elixir"><span class="z-source z-elixir"><span class="z-entity z-name z-class z-elixir">Enum</span><span class="z-punctuation z-separator z-method z-elixir">.</span>sort_by<span class="z-punctuation z-section z-function z-elixir">(</span>base_classes<span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-variable z-other z-capture z-elixir"><span class="z-keyword z-operator z-capture z-elixir">&amp;</span>class_position</span><span class="z-keyword z-operator z-arithmetic z-elixir">/</span><span class="z-constant z-numeric z-elixir">1</span><span class="z-punctuation z-section z-function z-elixir">)</span>
</span></code></pre>
<p>Iâ€™m not sure why I thought I had to explicitly store the position of the class in order to sort it. But it isnâ€™t needed at all.</p>
<p>Another example is <code>sort_variant_classes</code>. Itâ€™s a large chain of functions, bear with me:</p>
<pre data-lang="elixir" class="language-elixir z-code"><code class="language-elixir" data-lang="elixir"><span class="z-source z-elixir"><span class="z-meta z-function z-elixir"><span class="z-keyword z-control z-module z-elixir">defp</span> <span class="z-entity z-name z-function z-private z-elixir">sort_variant_classes</span><span class="z-punctuation z-definition z-parameters z-elixir">(</span>variants<span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-control z-module z-elixir">do</span></span>
  variants
  <span class="z-keyword z-operator z-pipe z-elixir">|&gt;</span> group_by_first_variant<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-function z-elixir">)</span>
  <span class="z-keyword z-operator z-pipe z-elixir">|&gt;</span> sort_variant_groups<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-function z-elixir">)</span>
  <span class="z-keyword z-operator z-pipe z-elixir">|&gt;</span> sort_classes_per_variant<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-function z-elixir">)</span>
  <span class="z-keyword z-operator z-pipe z-elixir">|&gt;</span> grouped_variants_to_list<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-function z-elixir">)</span>
<span class="z-keyword z-control z-elixir">end</span>

<span class="z-meta z-function z-elixir"><span class="z-keyword z-control z-module z-elixir">defp</span> <span class="z-entity z-name z-function z-private z-elixir">group_by_first_variant</span><span class="z-punctuation z-definition z-parameters z-elixir">(</span>variants<span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-control z-module z-elixir">do</span></span>
  variants
  <span class="z-keyword z-operator z-pipe z-elixir">|&gt;</span> <span class="z-entity z-name z-class z-elixir">Enum</span><span class="z-punctuation z-separator z-method z-elixir">.</span>map<span class="z-punctuation z-section z-function z-elixir">(</span>&amp;<span class="z-entity z-name z-class z-elixir">String</span><span class="z-punctuation z-separator z-method z-elixir">.</span>split<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-constant z-other z-capture z-elixir"><span class="z-keyword z-operator z-capture z-elixir">&amp;</span>1</span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-meta z-string z-elixir"><span class="z-string z-quoted z-double z-elixir"><span class="z-punctuation z-definition z-string z-begin z-elixir">&quot;</span>:<span class="z-punctuation z-definition z-string z-end z-elixir">&quot;</span></span></span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-other z-keywords z-elixir">parts<span class="z-punctuation z-definition z-constant z-elixir">:</span></span> <span class="z-constant z-numeric z-elixir">2</span><span class="z-punctuation z-section z-function z-elixir">)</span><span class="z-punctuation z-section z-function z-elixir">)</span>
  <span class="z-keyword z-operator z-pipe z-elixir">|&gt;</span> <span class="z-entity z-name z-class z-elixir">Enum</span><span class="z-punctuation z-separator z-method z-elixir">.</span>group_by<span class="z-punctuation z-section z-function z-elixir">(</span>&amp;<span class="z-entity z-name z-class z-elixir">List</span><span class="z-punctuation z-separator z-method z-elixir">.</span>first<span class="z-keyword z-operator z-arithmetic z-elixir">/</span><span class="z-constant z-numeric z-elixir">1</span><span class="z-punctuation z-separator z-object z-elixir">,</span> &amp;<span class="z-entity z-name z-class z-elixir">List</span><span class="z-punctuation z-separator z-method z-elixir">.</span>last<span class="z-keyword z-operator z-arithmetic z-elixir">/</span><span class="z-constant z-numeric z-elixir">1</span><span class="z-punctuation z-section z-function z-elixir">)</span>
<span class="z-keyword z-control z-elixir">end</span>

<span class="z-meta z-function z-elixir"><span class="z-keyword z-control z-module z-elixir">defp</span> <span class="z-entity z-name z-function z-private z-elixir">sort_variant_groups</span><span class="z-punctuation z-definition z-parameters z-elixir">(</span>variant_groups<span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-control z-module z-elixir">do</span></span>
  variant_groups
  <span class="z-keyword z-operator z-pipe z-elixir">|&gt;</span> <span class="z-entity z-name z-class z-elixir">Enum</span><span class="z-punctuation z-separator z-method z-elixir">.</span>map<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-keyword z-control z-elixir">fn</span> variant_group <span class="z-keyword z-operator z-other z-elixir">-&gt;</span>
    variant <span class="z-keyword z-operator z-assignment z-elixir">=</span> elem<span class="z-punctuation z-section z-function z-elixir">(</span>variant_group<span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-numeric z-elixir">0</span><span class="z-punctuation z-section z-function z-elixir">)</span>
    sort_number <span class="z-keyword z-operator z-assignment z-elixir">=</span> <span class="z-entity z-name z-class z-elixir">Map</span><span class="z-punctuation z-separator z-method z-elixir">.</span>get<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-entity z-name z-class z-elixir">Defaults</span><span class="z-punctuation z-separator z-method z-elixir">.</span>variant_order<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-function z-elixir">)</span><span class="z-punctuation z-separator z-object z-elixir">,</span> variant<span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-keyword z-operator z-arithmetic z-elixir">-</span><span class="z-constant z-numeric z-elixir">1</span><span class="z-punctuation z-section z-function z-elixir">)</span>

    <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span>sort_number<span class="z-punctuation z-separator z-sequence z-elixir">,</span> variant_group<span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span>
  <span class="z-keyword z-control z-elixir">end</span><span class="z-punctuation z-section z-function z-elixir">)</span>
  <span class="z-keyword z-operator z-pipe z-elixir">|&gt;</span> <span class="z-entity z-name z-class z-elixir">Enum</span><span class="z-punctuation z-separator z-method z-elixir">.</span>sort_by<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-variable z-other z-capture z-elixir"><span class="z-keyword z-operator z-capture z-elixir">&amp;</span>elem</span><span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-constant z-other z-capture z-elixir"><span class="z-keyword z-operator z-capture z-elixir">&amp;</span>1</span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-numeric z-elixir">0</span><span class="z-punctuation z-section z-function z-elixir">)</span><span class="z-punctuation z-section z-function z-elixir">)</span>
  <span class="z-keyword z-operator z-pipe z-elixir">|&gt;</span> <span class="z-entity z-name z-class z-elixir">Enum</span><span class="z-punctuation z-separator z-method z-elixir">.</span>map<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-variable z-other z-capture z-elixir"><span class="z-keyword z-operator z-capture z-elixir">&amp;</span>elem</span><span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-constant z-other z-capture z-elixir"><span class="z-keyword z-operator z-capture z-elixir">&amp;</span>1</span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-numeric z-elixir">1</span><span class="z-punctuation z-section z-function z-elixir">)</span><span class="z-punctuation z-section z-function z-elixir">)</span>
<span class="z-keyword z-control z-elixir">end</span>

<span class="z-meta z-function z-elixir"><span class="z-keyword z-control z-module z-elixir">defp</span> <span class="z-entity z-name z-function z-private z-elixir">sort_classes_per_variant</span><span class="z-punctuation z-definition z-parameters z-elixir">(</span>grouped_variants<span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-control z-module z-elixir">do</span></span>
  <span class="z-entity z-name z-class z-elixir">Enum</span><span class="z-punctuation z-separator z-method z-elixir">.</span>map<span class="z-punctuation z-section z-function z-elixir">(</span>grouped_variants<span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-keyword z-control z-elixir">fn</span> variant_group <span class="z-keyword z-operator z-other z-elixir">-&gt;</span>
    <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span>variant<span class="z-punctuation z-separator z-sequence z-elixir">,</span> classes_and_variants<span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span> <span class="z-keyword z-operator z-assignment z-elixir">=</span> variant_group
    <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span>variant<span class="z-punctuation z-separator z-sequence z-elixir">,</span> sort<span class="z-punctuation z-section z-function z-elixir">(</span>classes_and_variants<span class="z-punctuation z-section z-function z-elixir">)</span><span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span>
  <span class="z-keyword z-control z-elixir">end</span><span class="z-punctuation z-section z-function z-elixir">)</span>
<span class="z-keyword z-control z-elixir">end</span>

<span class="z-meta z-function z-elixir"><span class="z-keyword z-control z-module z-elixir">defp</span> <span class="z-entity z-name z-function z-private z-elixir">grouped_variants_to_list</span><span class="z-punctuation z-definition z-parameters z-elixir">(</span>grouped_variants<span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-control z-module z-elixir">do</span></span>
  <span class="z-entity z-name z-class z-elixir">Enum</span><span class="z-punctuation z-separator z-method z-elixir">.</span>flat_map<span class="z-punctuation z-section z-function z-elixir">(</span>grouped_variants<span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-keyword z-control z-elixir">fn</span> variant_group <span class="z-keyword z-operator z-other z-elixir">-&gt;</span>
    <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span>variant<span class="z-punctuation z-separator z-sequence z-elixir">,</span> base_classes<span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span> <span class="z-keyword z-operator z-assignment z-elixir">=</span> variant_group

    <span class="z-entity z-name z-class z-elixir">Enum</span><span class="z-punctuation z-separator z-method z-elixir">.</span>map<span class="z-punctuation z-section z-function z-elixir">(</span>base_classes<span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-keyword z-control z-elixir">fn</span> class <span class="z-keyword z-operator z-other z-elixir">-&gt;</span>
      <span class="z-meta z-string z-elixir"><span class="z-string z-quoted z-double z-elixir"><span class="z-punctuation z-definition z-string z-begin z-elixir">&quot;</span></span></span></span><span class="z-source z-elixir"><span class="z-meta z-string z-elixir"><span class="z-string z-quoted z-double z-elixir"><span class="z-source z-elixir"><span class="z-meta z-string z-elixir"><span class="z-meta z-interpolation z-elixir"><span class="z-punctuation z-section z-interpolation z-begin z-elixir">#{</span></span></span></span></span></span></span><span class="z-source z-elixir"><span class="z-meta z-string z-elixir"><span class="z-meta z-interpolation z-elixir"><span class="z-source z-elixir z-embedded">variant</span><span class="z-punctuation z-section z-interpolation z-end z-elixir">}</span></span></span></span><span class="z-source z-elixir"><span class="z-meta z-string z-elixir"><span class="z-string z-quoted z-double z-elixir">:</span></span></span><span class="z-source z-elixir"><span class="z-meta z-string z-elixir"><span class="z-string z-quoted z-double z-elixir"><span class="z-source z-elixir"><span class="z-meta z-string z-elixir"><span class="z-meta z-interpolation z-elixir"><span class="z-punctuation z-section z-interpolation z-begin z-elixir">#{</span></span></span></span></span></span></span><span class="z-source z-elixir"><span class="z-meta z-string z-elixir"><span class="z-meta z-interpolation z-elixir"><span class="z-source z-elixir z-embedded">class</span><span class="z-punctuation z-section z-interpolation z-end z-elixir">}</span></span></span></span><span class="z-source z-elixir"><span class="z-meta z-string z-elixir"><span class="z-string z-quoted z-double z-elixir"><span class="z-punctuation z-definition z-string z-end z-elixir">&quot;</span></span></span>
    <span class="z-keyword z-control z-elixir">end</span><span class="z-punctuation z-section z-function z-elixir">)</span>
  <span class="z-keyword z-control z-elixir">end</span><span class="z-punctuation z-section z-function z-elixir">)</span>
<span class="z-keyword z-control z-elixir">end</span>
</span></code></pre>
<p>Looking at the previous example of <code>sort_base_classes()</code> you may notice the same poorly written pattern in <code>sort_variant_groups()</code>. Letâ€™s scrap that function entirely:</p>
<pre data-lang="elixir" class="language-elixir z-code"><code class="language-elixir" data-lang="elixir"><span class="z-source z-elixir"><span class="z-meta z-function z-elixir"><span class="z-keyword z-control z-module z-elixir">defp</span> <span class="z-entity z-name z-function z-private z-elixir">sort_variant_classes</span><span class="z-punctuation z-definition z-parameters z-elixir">(</span>variants<span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-control z-module z-elixir">do</span></span>
  variants
  <span class="z-keyword z-operator z-pipe z-elixir">|&gt;</span> group_by_first_variant<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-function z-elixir">)</span>
  <span class="z-keyword z-operator z-pipe z-elixir">|&gt;</span> <span class="z-entity z-name z-class z-elixir">Enum</span><span class="z-punctuation z-separator z-method z-elixir">.</span>sort_by<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-keyword z-control z-elixir">fn</span> <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span>variant<span class="z-punctuation z-separator z-sequence z-elixir">,</span> _rest<span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span> <span class="z-keyword z-operator z-other z-elixir">-&gt;</span> variant_position<span class="z-punctuation z-section z-function z-elixir">(</span>variant<span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-control z-elixir">end</span><span class="z-punctuation z-section z-function z-elixir">)</span>
  <span class="z-keyword z-operator z-pipe z-elixir">|&gt;</span> sort_classes_per_variant<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-function z-elixir">)</span>
  <span class="z-keyword z-operator z-pipe z-elixir">|&gt;</span> grouped_variants_to_list<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-function z-elixir">)</span>
<span class="z-keyword z-control z-elixir">end</span>
</span></code></pre>
<p>Much simpler and a whole lot more explicit too. I think you only want to use <code>elem()</code> when youâ€™re dealing with larger tuples. Itâ€™s better to pattern match against the tuple, and reads a lot easier.</p>
<p>Next on the list is <code>sort_classes_per_variant()</code>:</p>
<pre data-lang="elixir" class="language-elixir z-code"><code class="language-elixir" data-lang="elixir"><span class="z-source z-elixir"><span class="z-meta z-function z-elixir"><span class="z-keyword z-control z-module z-elixir">defp</span> <span class="z-entity z-name z-function z-private z-elixir">sort_classes_per_variant</span><span class="z-punctuation z-definition z-parameters z-elixir">(</span>grouped_variants<span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-control z-module z-elixir">do</span></span>
  <span class="z-entity z-name z-class z-elixir">Enum</span><span class="z-punctuation z-separator z-method z-elixir">.</span>map<span class="z-punctuation z-section z-function z-elixir">(</span>grouped_variants<span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-keyword z-control z-elixir">fn</span> variant_group <span class="z-keyword z-operator z-other z-elixir">-&gt;</span>
    <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span>variant<span class="z-punctuation z-separator z-sequence z-elixir">,</span> classes_and_variants<span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span> <span class="z-keyword z-operator z-assignment z-elixir">=</span> variant_group
    <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span>variant<span class="z-punctuation z-separator z-sequence z-elixir">,</span> sort<span class="z-punctuation z-section z-function z-elixir">(</span>classes_and_variants<span class="z-punctuation z-section z-function z-elixir">)</span><span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span>
  <span class="z-keyword z-control z-elixir">end</span><span class="z-punctuation z-section z-function z-elixir">)</span>
<span class="z-keyword z-control z-elixir">end</span>
</span></code></pre>
<p>This function is pointlessly verbose. Maybe I didnâ€™t know about pattern matching in the anonymous function call yet? Not sure.</p>
<p>Letâ€™s delete that one too:</p>
<pre data-lang="elixir" class="language-elixir z-code"><code class="language-elixir" data-lang="elixir"><span class="z-source z-elixir"><span class="z-meta z-function z-elixir"><span class="z-keyword z-control z-module z-elixir">defp</span> <span class="z-entity z-name z-function z-private z-elixir">sort_variant_classes</span><span class="z-punctuation z-definition z-parameters z-elixir">(</span>variants<span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-control z-module z-elixir">do</span></span>
  variants
  <span class="z-keyword z-operator z-pipe z-elixir">|&gt;</span> group_by_first_variant<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-function z-elixir">)</span>
  <span class="z-keyword z-operator z-pipe z-elixir">|&gt;</span> <span class="z-entity z-name z-class z-elixir">Enum</span><span class="z-punctuation z-separator z-method z-elixir">.</span>sort_by<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-keyword z-control z-elixir">fn</span> <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span>variant<span class="z-punctuation z-separator z-sequence z-elixir">,</span> _rest<span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span> <span class="z-keyword z-operator z-other z-elixir">-&gt;</span> variant_position<span class="z-punctuation z-section z-function z-elixir">(</span>variant<span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-control z-elixir">end</span><span class="z-punctuation z-section z-function z-elixir">)</span>
  <span class="z-keyword z-operator z-pipe z-elixir">|&gt;</span> <span class="z-entity z-name z-class z-elixir">Enum</span><span class="z-punctuation z-separator z-method z-elixir">.</span>map<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-keyword z-control z-elixir">fn</span> <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span>variant<span class="z-punctuation z-separator z-sequence z-elixir">,</span> rest<span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span> <span class="z-keyword z-operator z-other z-elixir">-&gt;</span> <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span>variant<span class="z-punctuation z-separator z-sequence z-elixir">,</span> sort<span class="z-punctuation z-section z-function z-elixir">(</span>rest<span class="z-punctuation z-section z-function z-elixir">)</span><span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span> <span class="z-keyword z-control z-elixir">end</span><span class="z-punctuation z-section z-function z-elixir">)</span>
  <span class="z-keyword z-operator z-pipe z-elixir">|&gt;</span> grouped_variants_to_list<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-function z-elixir">)</span>
<span class="z-keyword z-control z-elixir">end</span>
</span></code></pre>
<p>And finally, <code>grouped_variants_to_list()</code>. Letâ€™s look at it once more:</p>
<pre data-lang="elixir" class="language-elixir z-code"><code class="language-elixir" data-lang="elixir"><span class="z-source z-elixir"><span class="z-meta z-function z-elixir"><span class="z-keyword z-control z-module z-elixir">defp</span> <span class="z-entity z-name z-function z-private z-elixir">grouped_variants_to_list</span><span class="z-punctuation z-definition z-parameters z-elixir">(</span>grouped_variants<span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-control z-module z-elixir">do</span></span>
  <span class="z-entity z-name z-class z-elixir">Enum</span><span class="z-punctuation z-separator z-method z-elixir">.</span>flat_map<span class="z-punctuation z-section z-function z-elixir">(</span>grouped_variants<span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-keyword z-control z-elixir">fn</span> variant_group <span class="z-keyword z-operator z-other z-elixir">-&gt;</span>
    <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span>variant<span class="z-punctuation z-separator z-sequence z-elixir">,</span> base_classes<span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span> <span class="z-keyword z-operator z-assignment z-elixir">=</span> variant_group

    <span class="z-entity z-name z-class z-elixir">Enum</span><span class="z-punctuation z-separator z-method z-elixir">.</span>map<span class="z-punctuation z-section z-function z-elixir">(</span>base_classes<span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-keyword z-control z-elixir">fn</span> class <span class="z-keyword z-operator z-other z-elixir">-&gt;</span>
      <span class="z-meta z-string z-elixir"><span class="z-string z-quoted z-double z-elixir"><span class="z-punctuation z-definition z-string z-begin z-elixir">&quot;</span></span></span></span><span class="z-source z-elixir"><span class="z-meta z-string z-elixir"><span class="z-string z-quoted z-double z-elixir"><span class="z-source z-elixir"><span class="z-meta z-string z-elixir"><span class="z-meta z-interpolation z-elixir"><span class="z-punctuation z-section z-interpolation z-begin z-elixir">#{</span></span></span></span></span></span></span><span class="z-source z-elixir"><span class="z-meta z-string z-elixir"><span class="z-meta z-interpolation z-elixir"><span class="z-source z-elixir z-embedded">variant</span><span class="z-punctuation z-section z-interpolation z-end z-elixir">}</span></span></span></span><span class="z-source z-elixir"><span class="z-meta z-string z-elixir"><span class="z-string z-quoted z-double z-elixir">:</span></span></span><span class="z-source z-elixir"><span class="z-meta z-string z-elixir"><span class="z-string z-quoted z-double z-elixir"><span class="z-source z-elixir"><span class="z-meta z-string z-elixir"><span class="z-meta z-interpolation z-elixir"><span class="z-punctuation z-section z-interpolation z-begin z-elixir">#{</span></span></span></span></span></span></span><span class="z-source z-elixir"><span class="z-meta z-string z-elixir"><span class="z-meta z-interpolation z-elixir"><span class="z-source z-elixir z-embedded">class</span><span class="z-punctuation z-section z-interpolation z-end z-elixir">}</span></span></span></span><span class="z-source z-elixir"><span class="z-meta z-string z-elixir"><span class="z-string z-quoted z-double z-elixir"><span class="z-punctuation z-definition z-string z-end z-elixir">&quot;</span></span></span>
    <span class="z-keyword z-control z-elixir">end</span><span class="z-punctuation z-section z-function z-elixir">)</span>
  <span class="z-keyword z-control z-elixir">end</span><span class="z-punctuation z-section z-function z-elixir">)</span>
<span class="z-keyword z-control z-elixir">end</span>
</span></code></pre>
<p>This one is okay. Itâ€™s verbose and unnecessarily pattern matches within the function call, but it isnâ€™t too horrible compared to the others. We can use the same logic, just reduce it down a bit more.</p>
<p>Hereâ€™s the final implementation of <code>sort_variant_classes()</code>:</p>
<pre data-lang="elixir" class="language-elixir z-code"><code class="language-elixir" data-lang="elixir"><span class="z-source z-elixir"><span class="z-meta z-function z-elixir"><span class="z-keyword z-control z-module z-elixir">defp</span> <span class="z-entity z-name z-function z-private z-elixir">sort_variant_classes</span><span class="z-punctuation z-definition z-parameters z-elixir">(</span>variants<span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-control z-module z-elixir">do</span></span>
  variants
  <span class="z-keyword z-operator z-pipe z-elixir">|&gt;</span> group_by_first_variant<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-function z-elixir">)</span>
  <span class="z-keyword z-operator z-pipe z-elixir">|&gt;</span> <span class="z-entity z-name z-class z-elixir">Enum</span><span class="z-punctuation z-separator z-method z-elixir">.</span>sort_by<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-keyword z-control z-elixir">fn</span> <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span>variant<span class="z-punctuation z-separator z-sequence z-elixir">,</span> _rest<span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span> <span class="z-keyword z-operator z-other z-elixir">-&gt;</span> variant_position<span class="z-punctuation z-section z-function z-elixir">(</span>variant<span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-control z-elixir">end</span><span class="z-punctuation z-section z-function z-elixir">)</span>
  <span class="z-keyword z-operator z-pipe z-elixir">|&gt;</span> <span class="z-entity z-name z-class z-elixir">Enum</span><span class="z-punctuation z-separator z-method z-elixir">.</span>map<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-keyword z-control z-elixir">fn</span> <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span>variant<span class="z-punctuation z-separator z-sequence z-elixir">,</span> rest<span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span> <span class="z-keyword z-operator z-other z-elixir">-&gt;</span> <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span>variant<span class="z-punctuation z-separator z-sequence z-elixir">,</span> sort<span class="z-punctuation z-section z-function z-elixir">(</span>rest<span class="z-punctuation z-section z-function z-elixir">)</span><span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span> <span class="z-keyword z-control z-elixir">end</span><span class="z-punctuation z-section z-function z-elixir">)</span>
  <span class="z-keyword z-operator z-pipe z-elixir">|&gt;</span> <span class="z-entity z-name z-class z-elixir">Enum</span><span class="z-punctuation z-separator z-method z-elixir">.</span>flat_map<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-keyword z-control z-elixir">fn</span> <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span>variant<span class="z-punctuation z-separator z-sequence z-elixir">,</span> rest<span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span> <span class="z-keyword z-operator z-other z-elixir">-&gt;</span> <span class="z-entity z-name z-class z-elixir">Enum</span><span class="z-punctuation z-separator z-method z-elixir">.</span>map<span class="z-punctuation z-section z-function z-elixir">(</span>rest<span class="z-punctuation z-separator z-object z-elixir">,</span> &amp;<span class="z-meta z-string z-elixir"><span class="z-string z-quoted z-double z-elixir"><span class="z-punctuation z-definition z-string z-begin z-elixir">&quot;</span></span></span></span><span class="z-source z-elixir"><span class="z-meta z-string z-elixir"><span class="z-string z-quoted z-double z-elixir"><span class="z-source z-elixir"><span class="z-meta z-string z-elixir"><span class="z-meta z-interpolation z-elixir"><span class="z-punctuation z-section z-interpolation z-begin z-elixir">#{</span></span></span></span></span></span></span><span class="z-source z-elixir"><span class="z-meta z-string z-elixir"><span class="z-meta z-interpolation z-elixir"><span class="z-source z-elixir z-embedded">variant</span><span class="z-punctuation z-section z-interpolation z-end z-elixir">}</span></span></span></span><span class="z-source z-elixir"><span class="z-meta z-string z-elixir"><span class="z-string z-quoted z-double z-elixir">:</span></span></span><span class="z-source z-elixir"><span class="z-meta z-string z-elixir"><span class="z-string z-quoted z-double z-elixir"><span class="z-source z-elixir"><span class="z-meta z-string z-elixir"><span class="z-meta z-interpolation z-elixir"><span class="z-punctuation z-section z-interpolation z-begin z-elixir">#{</span></span></span></span></span></span></span><span class="z-source z-elixir"><span class="z-meta z-string z-elixir"><span class="z-meta z-interpolation z-elixir"><span class="z-source z-elixir z-embedded"><span class="z-constant z-other z-capture z-elixir"><span class="z-keyword z-operator z-capture z-elixir">&amp;</span>1</span></span><span class="z-punctuation z-section z-interpolation z-end z-elixir">}</span></span></span></span><span class="z-source z-elixir"><span class="z-meta z-string z-elixir"><span class="z-string z-quoted z-double z-elixir"><span class="z-punctuation z-definition z-string z-end z-elixir">&quot;</span></span></span><span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-control z-elixir">end</span><span class="z-punctuation z-section z-function z-elixir">)</span>
<span class="z-keyword z-control z-elixir">end</span>
</span></code></pre>
<p>We deleted roughly ~25 lines of code by taking advantage of function pattern matching.</p>
<p>Hereâ€™s how the regular sort function looks now:</p>
<pre data-lang="elixir" class="language-elixir z-code"><code class="language-elixir" data-lang="elixir"><span class="z-source z-elixir"><span class="z-meta z-function z-elixir"><span class="z-keyword z-control z-module z-elixir">defp</span> <span class="z-entity z-name z-function z-private z-elixir">sort</span><span class="z-punctuation z-definition z-parameters z-elixir">(</span>class_list<span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-operator z-elixir">when</span> <span class="z-keyword z-guard z-elixir">is_list</span><span class="z-punctuation z-section z-function z-elixir">(</span>class_list<span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-control z-module z-elixir">do</span></span>
  <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span>variants<span class="z-punctuation z-separator z-sequence z-elixir">,</span> base_classes<span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span> <span class="z-keyword z-operator z-assignment z-elixir">=</span> <span class="z-entity z-name z-class z-elixir">Enum</span><span class="z-punctuation z-separator z-method z-elixir">.</span>split_with<span class="z-punctuation z-section z-function z-elixir">(</span>class_list<span class="z-punctuation z-separator z-object z-elixir">,</span> &amp;variant?<span class="z-keyword z-operator z-arithmetic z-elixir">/</span><span class="z-constant z-numeric z-elixir">1</span><span class="z-punctuation z-section z-function z-elixir">)</span>

  <span class="z-entity z-name z-class z-elixir">Enum</span><span class="z-punctuation z-separator z-method z-elixir">.</span>sort_by<span class="z-punctuation z-section z-function z-elixir">(</span>base_classes<span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-variable z-other z-capture z-elixir"><span class="z-keyword z-operator z-capture z-elixir">&amp;</span>class_position</span><span class="z-keyword z-operator z-arithmetic z-elixir">/</span><span class="z-constant z-numeric z-elixir">1</span><span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-operator z-list-manipulation z-elixir">++</span> sort_variant_classes<span class="z-punctuation z-section z-function z-elixir">(</span>variants<span class="z-punctuation z-section z-function z-elixir">)</span>
<span class="z-keyword z-control z-elixir">end</span>
</span></code></pre>
<p>Some may argue that the temporary variable names added clarity, and Iâ€™m not entirely sure. 
I like the less noise in this version, but maybe as I program more I will find myself thinking otherwise.</p>
<p>In conclusion, the old approach was messy regex and substitutions. The new version <em>still</em> has substitutions, but this time itâ€™s on the AST. The new algorithm:</p>
<ol>
<li>Parse the tree using Phoenix tokenizer</li>
<li>Grab all class attributes</li>
<li>For class attributes that are strings, pass to <code>sort()</code></li>
<li>For class attributes that are expressions, transform to AST and handle each expression type.</li>
<li>Render the new sorted string, and substitute it back into the contents.</li>
</ol>
<p>Expression types can be concatenations (<code>&lt;&gt;</code>) or interpolations (<code>#{@active}</code>). Arrays too (which Iâ€™ve yet to add support for, but itâ€™s coming up now that thereâ€™s an AST to work with).</p>
<p>Some of the expression <code>class</code> code is a little complicated. 
I imagine in time there can be another blog post like this that points out inefficiencies.</p>
<p>Besides support for arrays, I also want to support the <code>tailwind.config.js</code> file of the project. Not sure yet how to execute the JS code that extracts the classes from it. Will see.</p>
<p>Maintenance work can sometimes be grueling, but also satisfying too.</p>


<p class="tagsData">

</p>

      </main>
      <footer>
        <hr>
<div class=footContainer>
  <div class="footLeft">
    <p>Licensed under <a target="_blank" rel="noopener noreferrer" href="https://fr.wikipedia.org/wiki/Licence_MIT">MIT</a><br>
      Built with <a target="_blank" rel="noopener noreferrer" href="https://www.getzola.org">Zola</a> using <a target="_blank" rel="noopener noreferrer" href="https://github.com/Speyll/anemone">anemone</a> theme &amp; <a target="_blank" rel="noopener noreferrer" href="https://github.com/Speyll/veqev">veqev</a> colors.<br>
    </p>
  </div>
  <div class="footRight">
    <a class="icons__background" target="_blank" rel="noopener noreferrer" href="https://100phlecs.github.io/atom.xml" title="Subscribe via RSS for updates."><svg class="icons icons__background"><use href="https://100phlecs.github.io/icons.svg#rss"></use></svg></a>
  </div>
</div>
      </footer>
    </div>
  </body>
</html>
